<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸµ Moja Kolekcja Muzyki</title>
    <!-- PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#4ade80">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Muzyka">
<link rel="apple-touch-icon" href="icon-192.png">
    <link rel="stylesheet" href="style.css">
</head>
<body class="dark-theme">
    <div class="container">
        <!-- NagÅ‚Ã³wek -->
        <header>
            <h1>ğŸµ Moja Kolekcja Muzyki</h1>
            <p class="subtitle">ZarzÄ…dzaj swoimi ulubionymi albumami</p>
            
            <div class="header-actions">
                <button class="btn-secondary" onclick="toggleTheme()">
                    <span id="themeIcon">â˜€ï¸</span> Motyw
                </button>
                <button class="btn-secondary" onclick="showStats()">ğŸ“Š Statystyki</button>
                <button class="btn-secondary btn-random" onclick="randomAlbum()">ğŸ² Losowy</button>
                <button class="btn-secondary btn-wishlist" onclick="addToWishlist()">ğŸ“‹ Wishlist</button>
                <button class="btn-secondary btn-scan" onclick="openScannerModal()">ğŸ“· Skanuj kod</button>
                <button class="btn-secondary btn-mp3" onclick="openMp3Scanner()">ğŸµ Skanuj MP3</button>
                <button class="btn-secondary" onclick="fetchMissingCovers()">ğŸ–¼ï¸ Pobierz okÅ‚adki</button>
                <button class="btn-secondary btn-print" onclick="printCollection()">ğŸ–¨ï¸ Drukuj</button>
                <button class="btn-secondary" onclick="exportData()">ğŸ“¤ Eksport</button>
                <label class="btn-secondary">
                    ğŸ“¥ Import
                    <input type="file" id="importFile" accept=".json" hidden>
                </label>
                <button class="btn-secondary" id="toggleStorage" onclick="toggleStorageMode()">
                    â˜ï¸ Firebase
                </button>
                <span id="syncStatus" class="sync-status">ğŸ’¾ Lokalnie</span>
            </div>
        </header>

        <!-- Mini odtwarzacz -->
        <div id="miniPlayer" class="mini-player hidden">
            <div class="mini-player-info">
                <img id="miniPlayerCover" src="" alt="">
                <div>
                    <span id="miniPlayerTitle">-</span>
                    <span id="miniPlayerArtist">-</span>
                </div>
            </div>
            <div class="mini-player-controls">
                <button onclick="closePlayer()">âœ•</button>
            </div>
        </div>

        <!-- Formularz dodawania -->
        <section class="add-section">
            <div class="section-header">
                <h2>â• Dodaj nowy album</h2>
                <div class="quick-add-buttons">
                    <button type="button" class="btn-quick" onclick="openScannerModal()">ğŸ“· Skanuj kod</button>
                    <button type="button" class="btn-quick" onclick="openMp3Scanner()">ğŸµ Z pliku MP3</button>
                </div>
            </div>
            <form id="albumForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="artist">Artysta: *</label>
                        <input type="text" id="artist" placeholder="np. Queen" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="title">TytuÅ‚ albumu: *</label>
                        <input type="text" id="title" placeholder="np. A Night at the Opera" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="year">Rok wydania:</label>
                        <input type="number" id="year" placeholder="np. 1975" min="1900" max="2030">
                    </div>
                    
                    <div class="form-group">
                        <label for="genre">Gatunek:</label>
                        <select id="genre">
                            <option value="rock">ğŸ¸ Rock</option>
                            <option value="pop">ğŸ¤ Pop</option>
                            <option value="jazz">ğŸ· Jazz</option>
                            <option value="classical">ğŸ» Klasyczna</option>
                            <option value="electronic">ğŸ¹ Elektroniczna</option>
                            <option value="hip-hop">ğŸ§ Hip-Hop</option>
                            <option value="metal">ğŸ¤˜ Metal</option>
                            <option value="punk">âš¡ Punk</option>
                            <option value="blues">ğŸº Blues</option>
                            <option value="country">ğŸ¤  Country</option>
                            <option value="reggae">ğŸŒ´ Reggae</option>
                            <option value="soul">ğŸ’œ Soul/R&B</option>
                            <option value="folk">ğŸª• Folk</option>
                            <option value="indie">ğŸ­ Indie</option>
                            <option value="soundtrack">ğŸ¬ Soundtrack</option>
                            <option value="other">ğŸµ Inne</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="format">Format:</label>
                        <select id="format">
                            <option value="cd">ğŸ’¿ CD</option>
                            <option value="vinyl">ğŸ“€ Winyl</option>
                            <option value="digital">ğŸ“± Cyfrowy</option>
                            <option value="cassette">ğŸ“¼ Kaseta</option>
                            <option value="streaming">ğŸŒ Streaming</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="rating">Ocena:</label>
                        <div class="rating-input">
                            <input type="range" id="rating" min="1" max="5" value="3">
                            <span id="ratingValue">â­â­â­</span>
                        </div>
                    </div>
                </div>

                <div class="form-group full-width">
                    <label for="coverUrl">OkÅ‚adka (URL obrazka):</label>
                    <div class="cover-input-group">
                        <input type="url" id="coverUrl" placeholder="https://... lub zostaw puste">
                        <button type="button" class="btn-search-cover" onclick="searchCover()">ğŸ” Szukaj</button>
                    </div>
                    <div id="coverPreview" class="cover-preview"></div>
                </div>

                <div class="form-group full-width">
                    <label for="notes">Notatki:</label>
                    <textarea id="notes" placeholder="Twoje przemyÅ›lenia o albumie..." rows="2"></textarea>
                </div>
                
                <button type="submit" class="btn-add">â• Dodaj album</button>
            </form>
        </section>

        <!-- Statystyki -->
        <section class="stats-section">
            <div class="stat" onclick="showStats()">
                <span class="stat-number" id="totalAlbums">0</span>
                <span class="stat-label">AlbumÃ³w</span>
            </div>
            <div class="stat" onclick="showStats()">
                <span class="stat-number" id="totalArtists">0</span>
                <span class="stat-label">ArtystÃ³w</span>
            </div>
            <div class="stat" onclick="showStats()">
                <span class="stat-number" id="avgRating">0</span>
                <span class="stat-label">Åšr. ocena</span>
            </div>
            <div class="stat" onclick="showStats()">
                <span class="stat-number" id="totalFavorites">0</span>
                <span class="stat-label">Ulubionych</span>
            </div>
            <div class="stat stat-wishlist" onclick="document.getElementById('showWishlistOnly').checked = !document.getElementById('showWishlistOnly').checked; renderAlbums();">
                <span class="stat-number" id="totalWishlist">0</span>
                <span class="stat-label">ğŸ“‹ Wishlist</span>
            </div>
        </section>

        <!-- Filtry -->
        <section class="filter-section">
            <input type="text" id="searchInput" placeholder="ğŸ” Szukaj albumu lub artysty...">
            <select id="filterGenre">
                <option value="all">Wszystkie gatunki</option>
                <option value="rock">ğŸ¸ Rock</option>
                <option value="pop">ğŸ¤ Pop</option>
                <option value="jazz">ğŸ· Jazz</option>
                <option value="classical">ğŸ» Klasyczna</option>
                <option value="electronic">ğŸ¹ Elektroniczna</option>
                <option value="hip-hop">ğŸ§ Hip-Hop</option>
                <option value="metal">ğŸ¤˜ Metal</option>
                <option value="punk">âš¡ Punk</option>
                <option value="blues">ğŸº Blues</option>
                <option value="country">ğŸ¤  Country</option>
                <option value="reggae">ğŸŒ´ Reggae</option>
                <option value="soul">ğŸ’œ Soul/R&B</option>
                <option value="folk">ğŸª• Folk</option>
                <option value="indie">ğŸ­ Indie</option>
                <option value="soundtrack">ğŸ¬ Soundtrack</option>
                <option value="other">ğŸµ Inne</option>
            </select>
            <select id="filterFormat">
                <option value="all">Wszystkie formaty</option>
                <option value="cd">ğŸ’¿ CD</option>
                <option value="vinyl">ğŸ“€ Winyl</option>
                <option value="digital">ğŸ“± Cyfrowy</option>
                <option value="cassette">ğŸ“¼ Kaseta</option>
                <option value="streaming">ğŸŒ Streaming</option>
            </select>
            <select id="sortBy">
                <option value="newest">ğŸ• Ostatnio dodane</option>
                <option value="artist">ğŸ‘¤ Artysta A-Z</option>
                <option value="title">ğŸ“ TytuÅ‚ A-Z</option>
                <option value="rating">â­ NajwyÅ¼ej oceniane</option>
                <option value="year">ğŸ“… Rok wydania</option>
                <option value="favorites">â¤ï¸ Ulubione najpierw</option>
                <option value="wishlist">ğŸ“‹ Wishlist najpierw</option>
            </select>
        </section>

        <!-- Widok -->
        <section class="view-toggle">
            <button id="gridView" class="view-btn active" onclick="setView('grid')">â–¦ Siatka</button>
            <button id="listView" class="view-btn" onclick="setView('list')">â˜° Lista</button>
            <label class="favorites-only">
                <input type="checkbox" id="showFavoritesOnly"> â¤ï¸ Tylko ulubione
            </label>
            <label class="wishlist-only">
                <input type="checkbox" id="showWishlistOnly"> ğŸ“‹ Tylko wishlist
            </label>
        </section>

        <!-- Lista albumÃ³w -->
        <section class="albums-section">
            <h2>ğŸ“€ Twoja kolekcja <span id="albumCount"></span></h2>
            <div id="albumsList" class="albums-grid">
                <p class="empty-message">Twoja kolekcja jest pusta. Dodaj pierwszy album!</p>
            </div>
        </section>
    </div>

    <!-- Modal edycji -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEditModal()">&times;</span>
            <h2>âœï¸ Edytuj album</h2>
            <form id="editForm">
                <input type="hidden" id="editId">
                <div class="form-group">
                    <label for="editArtist">Artysta:</label>
                    <input type="text" id="editArtist" required>
                </div>
                <div class="form-group">
                    <label for="editTitle">TytuÅ‚:</label>
                    <input type="text" id="editTitle" required>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="editYear">Rok:</label>
                        <input type="number" id="editYear">
                    </div>
                    <div class="form-group">
                        <label for="editGenre">Gatunek:</label>
                        <select id="editGenre">
                            <option value="rock">ğŸ¸ Rock</option>
                            <option value="pop">ğŸ¤ Pop</option>
                            <option value="jazz">ğŸ· Jazz</option>
                            <option value="classical">ğŸ» Klasyczna</option>
                            <option value="electronic">ğŸ¹ Elektroniczna</option>
                            <option value="hip-hop">ğŸ§ Hip-Hop</option>
                            <option value="metal">ğŸ¤˜ Metal</option>
                            <option value="punk">âš¡ Punk</option>
                            <option value="blues">ğŸº Blues</option>
                            <option value="country">ğŸ¤  Country</option>
                            <option value="reggae">ğŸŒ´ Reggae</option>
                            <option value="soul">ğŸ’œ Soul/R&B</option>
                            <option value="folk">ğŸª• Folk</option>
                            <option value="indie">ğŸ­ Indie</option>
                            <option value="soundtrack">ğŸ¬ Soundtrack</option>
                            <option value="other">ğŸµ Inne</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="editFormat">Format:</label>
                        <select id="editFormat">
                            <option value="cd">ğŸ’¿ CD</option>
                            <option value="vinyl">ğŸ“€ Winyl</option>
                            <option value="digital">ğŸ“± Cyfrowy</option>
                            <option value="cassette">ğŸ“¼ Kaseta</option>
                            <option value="streaming">ğŸŒ Streaming</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editRating">Ocena:</label>
                        <div class="rating-input">
                            <input type="range" id="editRating" min="1" max="5" value="3">
                            <span id="editRatingValue">â­â­â­</span>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="editCoverUrl">OkÅ‚adka:</label>
                    <div class="cover-search-group">
                        <input type="url" id="editCoverUrl">
                        <button type="button" class="btn-search-cover" onclick="searchCoverEdit()">ğŸ” Szukaj</button>
                    </div>
                    <div id="editCoverPreview" class="cover-preview"></div>
                </div>
                <div class="form-group">
                    <label for="editNotes">Notatki:</label>
                    <textarea id="editNotes" rows="2"></textarea>
                </div>
                <button type="submit" class="btn-save">ğŸ’¾ Zapisz zmiany</button>
            </form>
        </div>
    </div>

    <!-- Modal szczegÃ³Å‚Ã³w albumu z utworami -->
<div id="detailsModal" class="modal">
    <div class="modal-content modal-details-large">
        <span class="close" onclick="closeDetailsModal()">&times;</span>
        <div id="detailsContent"></div>
    </div>
</div>

<!-- Wbudowany odtwarzacz audio -->
<div id="audioPlayerBar" class="audio-player-bar hidden">
    <div class="player-track-info">
        <img id="playerAlbumArt" src="" alt="">
        <div class="player-text">
            <span id="playerTrackTitle">-</span>
            <span id="playerTrackArtist">-</span>
        </div>
    </div>
    <div class="player-controls">
        <button onclick="prevTrack()">â®ï¸</button>
        <button onclick="togglePlay()" id="playPauseBtn">â–¶ï¸</button>
        <button onclick="nextTrack()">â­ï¸</button>
    </div>
    <div class="player-progress">
        <span id="currentTime">0:00</span>
        <input type="range" id="progressBar" min="0" max="100" value="0" onchange="seekTo(this.value)">
        <span id="totalTime">0:00</span>
    </div>
    <div class="player-volume">
        <span>ğŸ”Š</span>
        <input type="range" id="volumeBar" min="0" max="100" value="80" onchange="setVolume(this.value)">
    </div>
    <button class="player-close" onclick="closeAudioPlayer()">âœ•</button>
</div>

<audio id="audioElement"></audio>

    <!-- Modal statystyk -->
    <div id="statsModal" class="modal">
        <div class="modal-content modal-stats">
            <span class="close" onclick="closeStatsModal()">&times;</span>
            <h2>ğŸ“Š Statystyki kolekcji</h2>
            <div id="statsContent"></div>
        </div>
    </div>

    <!-- Modal odtwarzacza -->
    <div id="playerModal" class="modal">
        <div class="modal-content modal-player">
            <span class="close" onclick="closePlayerModal()">&times;</span>
            <div id="playerContent"></div>
        </div>
    </div>

    <!-- Modal losowy -->
    <div id="randomModal" class="modal">
        <div class="modal-content modal-random">
            <span class="close" onclick="closeRandomModal()">&times;</span>
            <div id="randomContent"></div>
        </div>
    </div>

    <!-- Modal skanera kodÃ³w kreskowych -->
    <div id="scannerModal" class="modal">
        <div class="modal-content modal-scanner">
            <span class="close" onclick="closeScannerModal()">&times;</span>
            <h2>ğŸ“· Skanuj kod kreskowy</h2>
            <div class="scanner-container">
                <div id="scannerPreview"></div>
                <p class="scanner-hint">Skieruj kamerÄ™ na kod kreskowy pÅ‚yty CD/winyla</p>
                
                <div class="scanner-manual">
                    <p>Lub wpisz kod rÄ™cznie:</p>
                    <div class="manual-input-group">
                        <input type="text" id="manualBarcode" placeholder="np. 0602547202888">
                        <button onclick="searchByBarcode(document.getElementById('manualBarcode').value)">ğŸ” Szukaj</button>
                    </div>
                </div>
                
                <div id="scannerResult" class="scanner-result hidden"></div>
            </div>
        </div>
    </div>

    <!-- Modal skanera MP3 -->
    <div id="mp3Modal" class="modal">
        <div class="modal-content modal-mp3">
            <span class="close" onclick="closeMp3Modal()">&times;</span>
            <h2>ğŸµ Skanuj pliki audio</h2>
            
            <div class="mp3-options">
                <div class="mp3-option">
                    <h3>ğŸ“ Wybierz folder</h3>
                    <p>Skanuj caÅ‚y folder z muzykÄ…</p>
                    <input type="file" id="folderInput" webkitdirectory directory multiple hidden>
                    <button class="btn-mp3-action" onclick="document.getElementById('folderInput').click()">
                        ğŸ“‚ Wybierz folder
                    </button>
                </div>
                
                <div class="mp3-option">
                    <h3>ğŸµ Wybierz pliki</h3>
                    <p>Wybierz pojedyncze pliki MP3/FLAC</p>
                    <input type="file" id="filesInput" accept=".mp3,.flac,.ogg,.m4a,.wav" multiple hidden>
                    <button class="btn-mp3-action" onclick="document.getElementById('filesInput').click()">
                        ğŸµ Wybierz pliki
                    </button>
                </div>
            </div>
            
            <div id="mp3Progress" class="mp3-progress hidden">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <p id="progressText">Skanowanie...</p>
            </div>
            
            <div id="mp3Results" class="mp3-results hidden">
                <h3>ğŸµ Znalezione albumy</h3>
                <div id="foundAlbums"></div>
                <div class="mp3-actions">
                    <button class="btn-add-all" onclick="addAllFoundAlbums()">â• Dodaj wszystkie</button>
                    <button class="btn-secondary" onclick="closeMp3Modal()">Anuluj</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <!-- Biblioteka do skanowania kodÃ³w -->
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    
    <!-- Biblioteka do odczytu tagÃ³w ID3 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsmediatags/3.9.5/jsmediatags.min.js"></script>
    
    <!-- Firebase config -->
    <script>
        // Bezpieczna inicjalizacja Firebase
        var firebaseInitialized = false;
        try {
            if (typeof firebase !== 'undefined') {
                const firebaseConfig = {
                    apiKey: "AIzaSyDGJMV76kwAwLCpgU-TeCKM20Y2e_ClKOw",
                    authDomain: "kolekcja-muzyki.firebaseapp.com",
                    projectId: "kolekcja-muzyki",
                    storageBucket: "kolekcja-muzyki.firebasestorage.app",
                    messagingSenderId: "1079629559114",
                    appId: "1:1079629559114:web:13c10b9a7f4f33c946bdb3",
                    measurementId: "G-E6K5DYCX02"
                };
                firebase.initializeApp(firebaseConfig);
                firebaseInitialized = true;
                console.log('âœ… Firebase SDK zaÅ‚adowany');
            } else {
                console.warn('âš ï¸ Firebase SDK niedostÄ™pny - tryb offline');
            }
        } catch (e) {
            console.warn('âš ï¸ BÅ‚Ä…d inicjalizacji Firebase:', e);
        }
    </script>
    
    <script src="app.js"></script>
</body>
</html>